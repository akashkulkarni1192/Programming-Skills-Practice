import java.net.UnknownHostException;
import java.util.ArrayList;
import java.util.List;
import java.util.Scanner;

import com.mongodb.BasicDBObject;
import com.mongodb.DB;
import com.mongodb.DBCollection;
import com.mongodb.DBCursor;
import com.mongodb.MongoClient;


public class ServerClass {
	static MongoClient server ;
	static DB db;
	public ServerClass(){
		try {
			server = new MongoClient( "localhost" , 27017 );
			db = server.getDB( "FinalYearDB" );
			
			System.out.println("Server connected to Database");
		} catch (UnknownHostException e) {
			e.printStackTrace();
		}
		
	}
	public boolean checkAuthentication(String uname, String passwd) {
		 DBCollection coll = db.getCollection("userProfile");
		 BasicDBObject query = new BasicDBObject("_id",uname);		//would be checked in registerUser Collection
		 DBCursor cursor = coll.find(query);
		 if(cursor.hasNext()){
			 BasicDBObject userLoggedIn = (BasicDBObject) cursor.next();
			 if(userLoggedIn.get("password").equals(passwd)){
				 System.out.println("Login Successful...Enjoy the Dive");
				 return true;
			 }
		 }else{
			 System.out.println("Wear Diving Suit Correctly");
		 }
		 return false;
	}
	public void createUserProfile() {
		DBCollection coll = db.getCollection("userProfile");
		BasicDBObject newUser = new BasicDBObject();
		System.out.print("Enter Username(ID) : ");
		Scanner scan = new Scanner(System.in);
		String uname = scan.next();
		newUser.put("_id", uname);
		System.out.print("\nWhat would be your key : ");
		String passwd = scan.next();
		newUser.put("password", passwd);
		System.out.print("\nWhat do you like to be called : ");
		String gname = scan.next();
		newUser.put("givenName", gname);
		System.out.print("\nAddress : ");
		String address= scan.next();
		newUser.put("address", address);
		List<BasicDBObject> friendList = new ArrayList<>();
		newUser.put("friendList", friendList);
		newUser.put("wallID", uname.subSequence(0, uname.length()-2)+"wall");
		coll.save(newUser);
	}
	public void showProfile(String uname) {
		DBCollection coll = db.getCollection("userProfile");
		BasicDBObject query = new BasicDBObject("_id",uname);
		DBCursor cursor = coll.find(query);	
		while(cursor.hasNext()){
			BasicDBObject user = (BasicDBObject) cursor.next();
			System.out.println("Given Name :" + user.getString("givenName"));
			System.out.println("Address :" + user.getString("address"));
			System.out.println("Friends : ");
			for(String friend : user.get("friendList")){
				System.out.println(friend);
			}
		}
		
	}

}
